name: Discord Component Notification

on:
  push:
    branches: [ "master", "dev" ]
  pull_request:
    branches: [ "master", "dev" ]
    types: [opened, closed]
  pull_request_review:
    types: [submitted]
  issue_comment:
    types: [created]

jobs:
  discord-notification:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request || github.event_name != 'issue_comment' # PR„Å´Èñ¢ÈÄ£„Åó„Å™„ÅÑIssue„Ç≥„É°„É≥„Éà„ÅØÈô§Â§ñ
    steps:
      - name: Prepare Notification Details
        id: info
        run: |
          # „Ç§„Éô„É≥„ÉàÂêç„Å´„Çà„Å£„Å¶Â§âÊï∞„ÅÆ‰∏≠Ë∫´„Çí„Çπ„Ç§„ÉÉ„ÉÅ
          case "${{ github.event_name }}" in
            "push")
              TITLE="üì¶ „Éñ„É©„É≥„ÉÅ${{ github.ref_name }}„Å´push„Åï„Çå„Åæ„Åó„Åü"
              DESC="„Ç≥„Éü„ÉÉ„ÉàÂÜÖÂÆπ: ${{ github.event.head_commit.message }}"
              URL="${{ github.event.compare }}"
              COLOR=3066993 # Blue
              ;;
            "pull_request")
              if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
                TITLE=":white_check_mark: PR„ÅåMerge„Åï„Çå„Åæ„Åó„Åü: #${{ github.event.pull_request.number }}"
                COLOR=6570404 # Purple
              elif [ "${{ github.event.action }}" = "closed" ]; then
                TITLE=":x: PR„Åå„ÇØ„É≠„Éº„Ç∫„Åï„Çå„Åæ„Åó„Åü: #${{ github.event.pull_request.number }}"
                COLOR=15158332 # Red
              else
                TITLE=":new: PR„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åó„Åü: #${{ github.event.pull_request.number }}"
                COLOR=3066993 # Blue
              fi
              DESC="${{ github.event.pull_request.title }}"
              BRANCH="${{ github.base_ref }} --> ${{ github.head_ref }}"
              URL="${{ github.event.pull_request.html_url }}"
              ;;
            "pull_request_review")
              TITLE="üîç „É¨„Éì„É•„Éº: ${{ github.event.review.state }}"
              DESC="Pull Request: ${{ github.event.pull_request.title }}"
              URL="${{ github.event.review.html_url }}"
              BRANCH="${{ github.base_ref }} --> ${{ github.head_ref }}"
              COLOR=15105570 # Orange
              ;;
            "issue_comment")
              TITLE="üí¨ Êñ∞„Åó„ÅÑ„Ç≥„É°„É≥„Éà„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åó„Åü"
              DESC="${{ github.event.comment.body }}"
              URL="${{ github.event.comment.html_url }}"
              BRANCH="${{ github.ref_name }}"
              COLOR=12370112 # Grey
              ;;
          esac

          # Âá∫ÂäõÂ§âÊï∞„Å®„Åó„Å¶‰øùÂ≠ò
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "desc=$DESC" >> $GITHUB_OUTPUT
          echo "url=$URL" >> $GITHUB_OUTPUT
          echo "color=$COLOR" >> $GITHUB_OUTPUT
          echo "branch=$BRANCH" >> $GITHUB_OUTPUT

      - name: Send Discord Webhook Embed
        run: |
          curl -H "Content-Type: application/json" \
                -X POST \
                -d '{
                  "embeds": [{
                    "title": "${{ steps.info.outputs.title }}",
                    "description": "${{ steps.info.outputs.desc }}",
                    "color": ${{ steps.info.outputs.color }},
                    "url": "${{ steps.info.outputs.url }}",
                    "author": {
                      "name": "${{ github.actor }}",
                      "icon_url": "https://github.com/${{ github.actor }}.png",
                      "url": "https://github.com/${{ github.actor }}"
                    },
                    "timestamp": {},
                    "fields": [
                      { name: "üë§ Êìç‰Ωú„Åó„Åü„É¶„Éº„Ç∂„Éº", value: "${{ github.actor }}", inline: true },
                      { name: ":deciduous_tree: „Éñ„É©„É≥„ÉÅ", value: "${{ steps.info.outputs.branch }}", inline: true },

                    ]
                  }]
                }' \
                ${{ secrets.DISCORD_WEBHOOK }}
