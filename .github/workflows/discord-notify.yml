name: Discord Component Notification

on:
  push:
    branches: [ "master", "dev" ]
  pull_request:
    branches: [ "master", "dev" ]
    types: [opened, closed]
  pull_request_review:
    types: [submitted]
  issue_comment:
    types: [created]

jobs:
  discord-notification:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request || github.event_name != 'issue_comment' # PR„Å´Èñ¢ÈÄ£„Åó„Å™„ÅÑIssue„Ç≥„É°„É≥„Éà„ÅØÈô§Â§ñ
    steps:
      - name: Prepare Notification Details
        id: info
        run: |
          # „Ç§„Éô„É≥„ÉàÂêç„Å´„Çà„Å£„Å¶Â§âÊï∞„ÅÆ‰∏≠Ë∫´„Çí„Çπ„Ç§„ÉÉ„ÉÅ
          case "${{ github.event_name }}" in
            "push")
              TITLE="üì¶ push„Åï„Çå„Åæ„Åó„Åü: ${{ github.ref_name }}"
              DESC="„Ç≥„Éü„ÉÉ„Éà: ${{ github.event.head_commit.message }}"
              URL="${{ github.event.compare }}"
              COLOR=3066993 # Blue
              ;;
            "pull_request")
              if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
                TITLE="üíú PR„ÅåMerge„Åï„Çå„Åæ„Åó„Åü: #${{ github.event.pull_request.number }}"
                COLOR=6570404 # Purple
              elif [ "${{ github.event.action }}" = "closed" ]; then
                TITLE="‚ùå PR„Åå„ÇØ„É≠„Éº„Ç∫„Åï„Çå„Åæ„Åó„Åü: #${{ github.event.pull_request.number }}"
                COLOR=15158332 # Red
              else
                TITLE="üÜï PR„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åó„Åü: #${{ github.event.pull_request.number }}"
                COLOR=3066993 # Blue
              fi
              DESC="${{ github.event.pull_request.title }}"
              URL="${{ github.event.pull_request.html_url }}"
              ;;
            "pull_request_review")
              TITLE="üîç „É¨„Éì„É•„Éº: ${{ github.event.review.state }}"
              DESC="Pull Request: ${{ github.event.pull_request.title }}"
              URL="${{ github.event.review.html_url }}"
              COLOR=15105570 # Orange
              ;;
            "issue_comment")
              TITLE="üí¨ Êñ∞„Åó„ÅÑ„Ç≥„É°„É≥„Éà"
              DESC="${{ github.event.comment.body }}"
              URL="${{ github.event.comment.html_url }}"
              COLOR=12370112 # Grey
              ;;
          esac

          # Âá∫ÂäõÂ§âÊï∞„Å®„Åó„Å¶‰øùÂ≠ò
          echo "title=$TITLE" >> $GITHUB_OUTPUT
          echo "desc=$DESC" >> $GITHUB_OUTPUT
          echo "url=$URL" >> $GITHUB_OUTPUT
          echo "color=$COLOR" >> $GITHUB_OUTPUT

      - name: Send Discord Webhook with Component V2
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d '{
                 "embeds": [{
                   "title": "${{ steps.info.outputs.title }}",
                   "description": "${{ steps.info.outputs.desc }}",
                   "color": ${{ steps.info.outputs.color }},
                   "author": {
                     "name": "${{ github.actor }}",
                     "icon_url": "https://github.com/${{ github.actor }}.png"
                   }
                 }],
                 "components": [
                   {
                     "type": 1,
                     "components": [
                       {
                         "type": 2,
                         "style": 5,
                         "label": "GitHub„ÅßÁ¢∫Ë™ç„Åô„Çã",
                         "url": "${{ steps.info.outputs.url }}"
                       }
                     ]
                   }
                 ]
               }' \
               ${{ secrets.DISCORD_WEBHOOK }}
